<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Inventario Papelería</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f4f4f9;
    }
    h1, h2 {
      text-align: center;
    }
    .formulario, .lista {
      background: white;
      padding: 20px;
      margin: 15px auto;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      max-width: 700px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, select, button {
      margin-top: 5px;
      padding: 8px;
      width: 100%;
    }
    .producto {
      border: 1px solid #ccc;
      padding: 10px;
      margin: 10px 0;
      display: flex;
      align-items: center;
      border-radius: 8px;
      background: #fafafa;
    }
    .producto img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      margin-right: 15px;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
    .acciones {
      margin-left: auto;
    }
    .acciones button {
      margin-left: 5px;
      padding: 6px 10px;
    }
    #busqueda {
      margin-bottom: 15px;
      padding: 10px;
      width: 100%;
      border-radius: 5px;
      border: 1px solid #aaa;
    }
  </style>
</head>
<body>
  <h1>Inventario Digital - Papelería</h1>

  <!-- Formulario de productos -->
  <div class="formulario">
    <h2>Agregar Producto</h2>
    <label>Nombre:</label>
    <input type="text" id="nombre">
    <label>Precio:</label>
    <input type="number" id="precio">
    <label>Cantidad:</label>
    <input type="number" id="cantidad">
    <label>Imagen:</label>
    <input type="file" id="imagen" accept="image/*">
    <button onclick="agregarProducto()">Agregar</button>
  </div>

  <!-- Búsqueda -->
  <input type="text" id="busqueda" placeholder="Buscar producto por nombre..." onkeyup="buscarProducto()">

  <!-- Lista de productos -->
  <div class="lista" id="listaProductos">
    <h2>Productos</h2>
  </div>

  <script>
    let productos = JSON.parse(localStorage.getItem("productos")) || [];

    function mostrarProductos(lista = productos) {
      const contenedor = document.getElementById("listaProductos");
      contenedor.innerHTML = "<h2>Productos</h2>";
      if (lista.length === 0) {
        contenedor.innerHTML += "<p>No hay productos registrados.</p>";
        return;
      }
      lista.forEach((p, index) => {
        const div = document.createElement("div");
        div.className = "producto";
        const img = p.imagen ? `<img src="${p.imagen}" alt="imagen">` : `<img src="" style="background:#ddd;">`;
        div.innerHTML = `
          ${img}
          <div>
            <p><strong>${p.nombre}</strong></p>
            <p>Precio: $${p.precio}</p>
            <p>Cantidad: ${p.cantidad}</p>
          </div>
          <div class="acciones">
            <button onclick="venderProducto(${index})">Vender</button>
            <button onclick="eliminarProducto(${index})">Eliminar</button>
          </div>
        `;
        contenedor.appendChild(div);
      });
    }

    function agregarProducto() {
      const nombre = document.getElementById("nombre").value;
      const precio = document.getElementById("precio").value;
      const cantidad = document.getElementById("cantidad").value;
      const imagenInput = document.getElementById("imagen");

      if (!nombre || !precio || !cantidad) {
        alert("Por favor complete todos los campos.");
        return;
      }

      let imagen = "";
      if (imagenInput.files && imagenInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          imagen = e.target.result;
          guardarProducto(nombre, precio, cantidad, imagen);
        }
        reader.readAsDataURL(imagenInput.files[0]);
      } else {
        guardarProducto(nombre, precio, cantidad, imagen);
      }
    }

    function guardarProducto(nombre, precio, cantidad, imagen) {
      productos.push({ nombre, precio, cantidad: parseInt(cantidad), imagen });
      localStorage.setItem("productos", JSON.stringify(productos));
      mostrarProductos();
      document.getElementById("nombre").value = "";
      document.getElementById("precio").value = "";
      document.getElementById("cantidad").value = "";
      document.getElementById("imagen").value = "";
    }

    function eliminarProducto(index) {
      productos.splice(index, 1);
      localStorage.setItem("productos", JSON.stringify(productos));
      mostrarProductos();
    }

    function venderProducto(index) {
      const cantidadDisponible = productos[index].cantidad;
      if (cantidadDisponible <= 0) {
        alert("No hay existencias de este producto.");
        return;
      }
      const vender = prompt(`¿Cuántas unidades desea vender? (Disponibles: ${cantidadDisponible})`);
      if (vender === null) return; // cancelar
      const cantidadVenta = parseInt(vender);
      if (isNaN(cantidadVenta) || cantidadVenta <= 0) {
        alert("Ingrese un número válido.");
        return;
      }
      if (cantidadVenta > cantidadDisponible) {
        alert("No puede vender más de lo disponible.");
        return;
      }
      productos[index].cantidad -= cantidadVenta;
      localStorage.setItem("productos", JSON.stringify(productos));
      mostrarProductos();
    }

    function buscarProducto() {
      const texto = document.getElementById("busqueda").value.toLowerCase();
      const filtrados = productos.filter(p => p.nombre.toLowerCase().includes(texto));
      mostrarProductos(filtrados);
    }

    mostrarProductos();
  </script>
</body>
</html>

